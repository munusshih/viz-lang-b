---
import Layout from "@/layouts/Layout.astro";
import Footer from "@/components/Footer.astro";
import Nav from "@/components/Nav.astro";
import CourseInfo from "@/components/CourseInfo.astro";
import { SITE_DESCRIPTION, SITE_TITLE, SECTION_ID } from "@/config";
import { getCollection } from "astro:content";
import { marked } from "marked";

// Get all weeks and sort by week number
const allWeeks = await getCollection("weeks");
const sortedWeeks = allWeeks
  .filter((week) => week.data.page !== false)
  .sort((a, b) => a.data.week - b.data.week);
---

<Layout
  title={`Schedule - ${SITE_TITLE}: ${SECTION_ID}`}
  description={SITE_DESCRIPTION}
>
  <header>
    <div class="course-info flex flex-col">
      <CourseInfo />
      <h1>Schedule & <br />Weekly View</h1>
    </div>
  </header>
  <main>
    <Nav />
    <section class="weekly-grid">
      {
        sortedWeeks.map((week) => (
          <article class="week-card">
            <a href={`/${week.id}/`} class="week-link">
              <div class="week-number">Week {week.data.week}</div>
              <h2 class="week-title">{week.data.title}</h2>
              {week.data.description && (
                <div
                  class="week-description"
                  set:html={marked.parse(week.data.description)}
                />
              )}
            </a>
          </article>
        ))
      }
    </section>
  </main>
  <Footer />
</Layout>

<style>
  .weekly-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }

  @media (max-width: 600px) {
    .weekly-grid {
      grid-template-columns: 1fr;
    }
  }

  .week-card {
    transition: all 0.2s ease;
    border-top: 2px solid #000;
    padding: 2rem 0rem;
  }

  .week-card:hover {
    transform: translateY(-2px);
    background: rgba(255, 192, 203, 0.2);
  }

  .week-link {
    display: block;
    color: inherit;
    text-decoration: none;
  }

  .week-number {
    opacity: 0.5;
    margin-bottom: 0.5rem;
    font-weight: 700;
    font-size: 0.875rem;
  }

  .week-title {
    margin-bottom: 0.75rem;
    font-weight: 700;
    font-size: 1.25rem;
    line-height: 1.3;
  }

  .week-description {
    opacity: 0.8;
    font-size: 0.95rem;
    line-height: 1.5;
  }

  .week-description :global(a) {
    color: inherit;
    text-decoration: underline;
  }
</style>
