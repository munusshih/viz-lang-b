---
import Layout from "@/layouts/Layout.astro";
import Footer from "@/components/Footer.astro";
import Nav from "@/components/Nav.astro";
import CourseInfo from "@/components/CourseInfo.astro";
import { SITE_DESCRIPTION, SITE_TITLE, SECTION_ID } from "@/config";
import { getCollection } from "astro:content";
import { marked } from "marked";

// Get all weeks and sort by week number (older first, newer lower on the page)
const allWeeks = await getCollection("weeks");
const sortedWeeks = allWeeks
  .filter((week) => week.data.week !== 0 && week.data.page !== false)
  .sort((a, b) => a.data.week - b.data.week);
---

<Layout
  title={`All Weeks - ${SITE_TITLE}: ${SECTION_ID}`}
  description={SITE_DESCRIPTION}
>
  <header>
    <div class="course-info flex flex-col">
      <CourseInfo />
      <h1>All Weeks</h1>
    </div>
  </header>
  <main>
    <Nav />
    <section class="weekly-list">
      {
        sortedWeeks.map((week) => (
          <article class="week-card">
            <a href={`/${week.id}/`} class="week-link">
              <div class="week-number">Week {week.data.week}</div>
              <h2 class="week-title">{week.data.title}</h2>
              {week.data.image && (
                <div class="week-media">
                  <img
                    src={`/${week.data.image}`}
                    alt={`Illustration for Week ${week.data.week}`}
                    loading="lazy"
                  />
                </div>
              )}
              {(week.data.description || week.data.longDescription) && (
                <div
                  class="week-description"
                  set:html={marked.parse(
                    week.data.description || week.data.longDescription || "",
                  )}
                />
              )}
            </a>
          </article>
        ))
      }
    </section>
  </main>
  <Footer />
</Layout>

<style>
  .week-card {
    transition: all 0.2s ease;
    padding: 0rem 0rem;
  }

  .week-card:hover {
    transform: translateY(-2px);
    background: color-mix(in srgb, var(--color-pink) 20%, transparent);
  }

  .week-link:hover {
    display: block;
    border: 0;
    color: inherit;
    text-decoration: none;
  }

  .week-number {
    opacity: 0.5;
    margin-bottom: 0.5rem;
    font-weight: 700;
    font-size: 0.875rem;
  }

  .week-title {
    margin-bottom: 0.75rem;
    font-weight: 700;
    font-size: 1.5rem;
    line-height: 1.3;
  }

  .week-media {
    margin: 1rem 0;
  }

  .week-media img {
    display: block;
    max-width: 60%;
    height: auto;
  }

  .week-description {
    opacity: 0.8;
    font-size: 0.95rem;
    line-height: 1.6;
  }

  .week-description :global(p) {
    padding-right: 1rem;
  }

  .week-description :global(a) {
    color: inherit;
    text-decoration: underline;
  }
</style>
