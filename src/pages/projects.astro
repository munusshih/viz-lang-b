---
import Layout from "@/layouts/Layout.astro";
import Footer from "@/components/Footer.astro";
import Nav from "@/components/Nav.astro";
import CourseInfo from "@/components/CourseInfo.astro";
import Colophon from "@/components/Colophon.astro";
import { SITE_DESCRIPTION, SITE_TITLE, SECTION_ID } from "@/config";
import { getCollection, render } from "astro:content";

const allProjects = await getCollection("projects");
const sortedProjects = allProjects
  .filter((project) => project.data.page !== false)
  .sort((a, b) => {
    const orderA = a.data.order ?? Number.POSITIVE_INFINITY;
    const orderB = b.data.order ?? Number.POSITIVE_INFINITY;
    if (orderA !== orderB) return orderA - orderB;
    return a.id.localeCompare(b.id);
  });

const renderedProjects = await Promise.all(
  sortedProjects.map(async (project) => {
    const { Content } = await render(project);
    return { project, Content };
  }),
);
---

<Layout
  title={`Projects - ${SITE_TITLE}: ${SECTION_ID}`}
  description={SITE_DESCRIPTION}
>
  <header>
    <div class="course-info flex flex-col">
      <CourseInfo />
      <h1>Projects</h1>
    </div>
  </header>
  <main>
    <Nav />
    <section class="projects-list">
      {
        renderedProjects.map(({ project, Content }) => (
          <Colophon title={project.data.title} fullWidth>
            <div class="lg:columns-2 gap-20">
              {project.data.description && (
                <p class="project-description">{project.data.description}</p>
              )}
              <Content />
            </div>
          </Colophon>
        ))
      }
    </section>
  </main>
  <Footer />
</Layout>

<style>
  .projects-list :global(h2) {
    margin-bottom: 1rem;
  }

  .projects-list :global(h3) {
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-weight: 900;
    font-family: "Belgika", serif;
  }

  .projects-list :global(p) {
    margin-bottom: 1rem;
  }

  .projects-list :global(ul) {
    margin-bottom: 1rem;
    padding-left: 1.25rem;
  }

  .projects-list :global(li) {
    margin-bottom: 0.35rem;
  }

  .project-description {
    opacity: 0.85;
    margin-bottom: 1rem;
  }

  .projects-list :global(ul > li) {
    position: relative;
  }
  .projects-list :global(ul > li)::before {
    position: absolute;
    left: -1.25em;
    content: "\2192\FE0E";
    font-weight: 400;
    font-family: "Comfortaa", sans-serif;
  }

  .projects-list :global(img) {
    margin-top: 2.5rem;
    margin-bottom: 2.5rem;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .projects-list :global(img + p),
  .projects-list :global(p:has(img)) {
    opacity: 0.7;
    margin-top: -1.75rem;
    padding-left: 2rem;
    font-size: 0.8rem;
  }
</style>
